---
sidebar_position: 4
title: Security Model
---

# Security Model

## Overview

The PMS (Portfolio Management System) implements a comprehensive, defense-in-depth security architecture designed to protect sensitive financial data, ensure regulatory compliance, and maintain operational integrity. This document outlines the security principles, controls, and implementation details that govern the platform.

## Security Principles

### Core Security Tenets

- **Defense in Depth**: Multiple layers of security controls
- **Zero Trust**: Never trust, always verify
- **Least Privilege**: Minimum required access rights
- **Fail-Safe Defaults**: Secure by default configurations
- **Audit Everything**: Comprehensive logging and monitoring

### Compliance Framework

- **SOC 2 Type II**: Security, availability, and confidentiality controls
- **GDPR**: Data protection and privacy regulations
- **PCI DSS**: Payment card industry data security standards
- **NIST Cybersecurity Framework**: Risk management and security controls

## Authentication & Authorization

### JWT-Based Authentication

#### Token Structure

```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "user123",
    "roles": ["TRADER", "ANALYST"],
    "exp": 1640995200,
    "iat": 1640991600,
    "iss": "pms-auth-service"
  },
  "signature": "HMACSHA256(base64UrlEncode(header) + '.' + base64UrlEncode(payload), secret)"
}
```

#### Token Lifecycle

- **Issuance**: Generated by Auth Service with configurable expiration
- **Validation**: Verified by API Gateway and individual services
- **Refresh**: Automatic token renewal for active sessions
- **Revocation**: Immediate invalidation for security events

### Authorization Model

#### Role-Based Access Control (RBAC)

| Role        | Description           | Permissions                           |
| ----------- | --------------------- | ------------------------------------- |
| **Viewer**  | Read-only access      | View dashboards, reports, analytics   |
| **Trader**  | Trade execution       | Execute trades, view positions        |
| **Analyst** | Data analysis         | Full analytics, custom reports        |
| **Manager** | Portfolio management  | Portfolio CRUD, risk overrides        |
| **Admin**   | System administration | User management, system configuration |

#### Permission Matrix

```typescript
interface Permissions {
  // Dashboard Access
  dashboard: {
    view: boolean;
    export: boolean;
  };

  // Trading Operations
  trading: {
    execute: boolean;
    cancel: boolean;
    modify: boolean;
  };

  // Analytics
  analytics: {
    realtime: boolean;
    historical: boolean;
    custom: boolean;
  };

  // Administration
  admin: {
    users: boolean;
    system: boolean;
    audit: boolean;
  };
}
```

### Multi-Factor Authentication (MFA)

- **TOTP**: Time-based one-time passwords
- **SMS**: SMS-based verification codes
- **Hardware Keys**: FIDO2/WebAuthn support
- **Biometric**: Device biometric authentication

## Network Security

### Perimeter Security

#### AWS Application Load Balancer (ALB)

- **SSL/TLS Termination**: End-to-end encryption with TLS 1.3
- **Web Application Firewall (WAF)**: OWASP Top 10 protection
- **Rate Limiting**: DDoS protection and abuse prevention
- **Health Checks**: Automated failover and load balancing

#### Security Groups

```hcl
# ALB Security Group
resource "aws_security_group" "alb" {
  name_prefix = "pms-alb-"

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]  # Restrict in production
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

# Application Security Group
resource "aws_security_group" "app" {
  name_prefix = "pms-app-"

  ingress {
    from_port       = 8080
    to_port         = 8080
    protocol        = "tcp"
    security_groups = [aws_security_group.alb.id]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}
```

### Internal Network Security

#### Kubernetes Network Policies

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: api-gateway-policy
  namespace: pms
spec:
  podSelector:
    matchLabels:
      app: api-gateway
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: auth
      ports:
        - protocol: TCP
          port: 8081
    - to:
        - podSelector:
            matchLabels:
              app: postgres
      ports:
        - protocol: TCP
          port: 5432
```

#### Service Mesh (Future)

- **Istio Integration**: Service-to-service authentication and authorization
- **Mutual TLS**: Automatic mTLS between services
- **Traffic Policies**: Fine-grained traffic control and security

## Data Security

### Encryption at Rest

#### Database Encryption

- **PostgreSQL**: Transparent Data Encryption (TDE)
- **AWS RDS**: AES-256 encryption with AWS KMS
- **Backup Encryption**: All backups encrypted with unique keys

#### File Storage

- **S3 Encryption**: Server-side encryption with SSE-KMS
- **Object Lock**: WORM (Write Once, Read Many) for compliance
- **Versioning**: Protected against ransomware and accidental deletion

### Encryption in Transit

#### TLS Configuration

```nginx
# Nginx SSL Configuration
server {
    listen 443 ssl http2;
    server_name api.pms.example.com;

    ssl_certificate /etc/ssl/certs/pms.crt;
    ssl_certificate_key /etc/ssl/private/pms.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;
    ssl_prefer_server_ciphers off;

    # HSTS
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # Security Headers
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Referrer-Policy strict-origin-when-cross-origin;
}
```

#### WebSocket Security

- **WSS Protocol**: Encrypted WebSocket connections
- **Origin Validation**: CORS protection for WebSocket handshakes
- **Authentication**: JWT tokens in WebSocket subprotocol headers

### Data Classification & Handling

#### Data Classification Levels

| Level            | Description        | Examples            | Protection                   |
| ---------------- | ------------------ | ------------------- | ---------------------------- |
| **Public**       | Non-sensitive data | Marketing materials | Standard encryption          |
| **Internal**     | Business-sensitive | Performance metrics | Access controls              |
| **Confidential** | Financial data     | Trade details, P&L  | Encryption + audit           |
| **Restricted**   | PII, secrets       | User credentials    | Zero-knowledge, tokenization |

#### Data Handling Procedures

- **Data Minimization**: Collect only necessary data
- **Purpose Limitation**: Use data only for intended purposes
- **Retention Limits**: Automatic data deletion after retention periods
- **Data Subject Rights**: GDPR compliance for data access/deletion

## Secret Management

### AWS Secrets Manager Integration

#### Secret Structure

```json
{
  "pms/prod/database": {
    "username": "pms_app",
    "password": "encrypted_password",
    "host": "pms-prod.cluster-xyz.rds.amazonaws.com",
    "port": "5432",
    "dbname": "pmsdb",
    "sslmode": "require"
  },
  "pms/prod/jwt": {
    "secret": "256-bit-secret-key",
    "issuer": "pms-auth-service",
    "audience": "pms-platform",
    "expiration": "3600"
  }
}
```

#### External Secrets Operator (ESO)

```yaml
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-secret
  namespace: pms
spec:
  refreshInterval: 15s
  secretStoreRef:
    name: aws-secretsmanager
    kind: SecretStore
  target:
    name: db-secret
    creationPolicy: Owner
  data:
    - secretKey: username
      remoteRef:
        key: pms/prod/database
        property: username
    - secretKey: password
      remoteRef:
        key: pms/prod/database
        property: password
```

### Key Rotation

- **Automatic Rotation**: Secrets rotated every 30 days
- **Emergency Rotation**: Immediate rotation for compromised secrets
- **Version History**: Maintain previous versions during transition
- **Zero Downtime**: Rolling updates during rotation

## Application Security

### Input Validation & Sanitization

#### API Gateway Validation

```typescript
// Request validation middleware
@Injectable()
export class ValidationInterceptor implements HttpInterceptor {
  intercept(
    req: HttpRequest<any>,
    next: HttpHandler,
  ): Observable<HttpEvent<any>> {
    // Input sanitization
    const sanitizedBody = this.sanitizeInput(req.body);

    // Schema validation
    const validationErrors = this.validateSchema(sanitizedBody);
    if (validationErrors.length > 0) {
      throw new BadRequestException(validationErrors);
    }

    return next.handle(req.clone({ body: sanitizedBody }));
  }
}
```

#### SQL Injection Prevention

- **Prepared Statements**: All database queries use parameterized statements
- **ORM Protection**: Hibernate/JPA prevents SQL injection
- **Input Validation**: Whitelist validation for all inputs

### Cross-Site Scripting (XSS) Protection

- **Content Security Policy (CSP)**: Strict CSP headers
- **Input Sanitization**: Angular DOM sanitization
- **Output Encoding**: Automatic encoding of user-generated content

### Cross-Site Request Forgery (CSRF) Protection

- **SameSite Cookies**: Strict SameSite cookie policy
- **CSRF Tokens**: Synchronizer token pattern
- **Origin Validation**: CORS policy enforcement

## Infrastructure Security

### Container Security

#### Image Security

- **Base Images**: Minimal, hardened base images
- **Vulnerability Scanning**: Trivy scans for CVEs
- **Image Signing**: Cosign for image integrity
- **Immutable Tags**: SHA-based image references

#### Runtime Security

```yaml
# Pod Security Standards
apiVersion: v1
kind: Pod
metadata:
  name: secure-pod
  annotations:
    container.apparmor.security.beta.kubernetes.io/app: runtime/default
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
  containers:
    - name: app
      securityContext:
        allowPrivilegeEscalation: false
        readOnlyRootFilesystem: true
        capabilities:
          drop:
            - ALL
```

### Kubernetes Security

#### RBAC Configuration

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pms-service-role
  namespace: pms
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list", "watch"]
  - apiGroups: ["external-secrets.io"]
    resources: ["externalsecrets"]
    verbs: ["get", "list", "watch", "create", "update"]
```

#### Service Account Security

- **IAM Roles for Service Accounts (IRSA)**: AWS IAM integration
- **Minimal Permissions**: Least privilege for service accounts
- **Token Rotation**: Automatic token refresh

## Monitoring & Auditing

### Security Event Monitoring

#### Audit Logging

```typescript
// Security event logging
@Injectable()
export class AuditService {
  async logSecurityEvent(event: SecurityEvent): Promise<void> {
    const auditEntry = {
      timestamp: new Date().toISOString(),
      userId: event.userId,
      action: event.action,
      resource: event.resource,
      ipAddress: event.ipAddress,
      userAgent: event.userAgent,
      success: event.success,
      details: event.details,
    };

    await this.auditRepository.save(auditEntry);
  }
}
```

#### Security Events

- **Authentication Events**: Login, logout, failed attempts
- **Authorization Events**: Permission changes, access denials
- **Data Access Events**: Sensitive data access, exports
- **Configuration Changes**: Security policy modifications

### Intrusion Detection

#### Anomaly Detection

- **Behavioral Analysis**: User behavior anomaly detection
- **Traffic Analysis**: DDoS and attack pattern recognition
- **Log Analysis**: Automated threat detection in logs

#### Alerting

```yaml
# Prometheus alerting rules
groups:
  - name: security_alerts
    rules:
      - alert: HighFailedLoginRate
        expr: rate(login_failures_total[5m]) > 10
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High rate of failed login attempts"
          description: "More than 10 failed login attempts per minute"

      - alert: UnauthorizedAccess
        expr: rate(unauthorized_access_total[5m]) > 5
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Unauthorized access attempts detected"
```

## Incident Response

### Security Incident Response Plan

#### Incident Classification

| Level        | Description                           | Response Time        | Escalation         |
| ------------ | ------------------------------------- | -------------------- | ------------------ |
| **Critical** | Active breach, data exfiltration      | Immediate (< 1 hour) | Executive + Legal  |
| **High**     | Suspected breach, system compromise   | < 4 hours            | Security Team Lead |
| **Medium**   | Policy violation, suspicious activity | < 24 hours           | Security Team      |
| **Low**      | Minor violation, false positive       | < 72 hours           | Individual review  |

#### Response Process

1. **Detection**: Automated alerts and monitoring
2. **Assessment**: Incident triage and impact analysis
3. **Containment**: Isolate affected systems
4. **Eradication**: Remove threat and vulnerabilities
5. **Recovery**: Restore systems and validate integrity
6. **Lessons Learned**: Post-incident review and improvements

### Breach Notification

- **Regulatory Requirements**: 72-hour notification for data breaches
- **Stakeholder Communication**: Transparent communication plan
- **Legal Compliance**: GDPR Article 33/34 notification requirements

## Compliance & Governance

### Regulatory Compliance

#### SOC 2 Controls

- **Security**: Protect against unauthorized access
- **Availability**: Ensure system availability
- **Confidentiality**: Protect sensitive information
- **Privacy**: Handle personal data appropriately

#### GDPR Compliance

- **Data Protection Officer**: Designated DPO responsibilities
- **Data Processing Agreements**: Vendor and partner agreements
- **Data Subject Rights**: Access, rectification, erasure rights
- **Breach Notification**: 72-hour notification requirement

### Security Governance

#### Security Committee

- **Composition**: Executive, IT, Legal, Compliance representatives
- **Frequency**: Monthly security reviews
- **Responsibilities**: Policy approval, risk assessment, incident oversight

#### Security Policies

- **Acceptable Use Policy**: User responsibilities and restrictions
- **Data Classification Policy**: Data handling requirements
- **Incident Response Policy**: Response procedures and responsibilities
- **Change Management Policy**: Security review for changes

## Security Testing

### Automated Security Testing

#### CI/CD Security Gates

```yaml
# GitHub Actions security workflow
name: Security Scan
on: [push, pull_request]

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: "fs"
          scan-ref: "."
          format: "sarif"
          output: "trivy-results.sarif"

      - name: Run Snyk for dependencies
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: Run OWASP ZAP baseline scan
        uses: zaproxy/action-baseline@v0.7.0
        with:
          target: "http://localhost:3000"
```

#### Penetration Testing

- **External Testing**: Annual third-party penetration testing
- **Internal Testing**: Quarterly internal security assessments
- **Bug Bounty Program**: Responsible disclosure program

### Vulnerability Management

#### Vulnerability Scanning

- **Container Images**: Daily scans with Trivy
- **Dependencies**: Weekly scans with Snyk/OWASP Dependency Check
- **Infrastructure**: Continuous scanning with AWS Inspector

#### Patch Management

- **Critical Patches**: Applied within 24 hours
- **High Priority**: Applied within 7 days
- **Standard Patches**: Applied monthly during maintenance windows
- **Emergency Changes**: Expedited change approval process

This security model provides a comprehensive framework for protecting the PMS platform while maintaining operational efficiency and regulatory compliance. All security controls are implemented with defense-in-depth principles and continuous monitoring.
